---
description: Documents data flow and communication between components in GPU optimization systems
globs: **/dualgpuopt/**/*.py,**/integrated_app/**/*.py,**/*service*.py,**/*event*.py
alwaysApply: false
---


# data-flow-architecture

Core Data Flow Components:

1. GPU Metrics Flow (80/100)
- Telemetry Service streams real-time GPU metrics:
  - Utilization, memory, temperature, power data
  - PCIe bandwidth monitoring 
  - Clock speeds and fan metrics
- Event Bus distributes metrics through priority-based channels
- Dashboard visualizes metrics through rolling 60-sample windows
File: dual_gpu_optimizer/dualgpuopt/telemetry.py

2. Optimization Pipeline (95/100)
- Layer Balance Service calculates optimal layer distribution
- GPU Split Service determines memory allocation ratios
- Context Size Calculator generates safe context lengths
- Command Generator produces framework-specific launch commands
Files:
- dualgpuopt/layer_balance.py
- dualgpuopt/optimizer.py

3. Configuration Flow (75/100)
- Config Service maintains per-GPU settings:
  - Overclock profiles
  - Fan curves
  - Power limits
  - Safety thresholds
- Settings persist across GPU switches
- State Service tracks active configurations
File: dual_gpu_optimizer/dualgpuopt/services/config_service.py

4. Event Distribution System (85/100)
- Priority-based event routing:
  - CRITICAL: Safety-related events
  - HIGH: Performance metrics
  - NORMAL: Status updates
  - LOW: Background telemetry
- Event Bus implements publish/subscribe pattern for GPU metrics
- Event Service coordinates metric distribution to UI components
File: dual_gpu_optimizer/dualgpuopt/services/event_service.py

5. Batch Processing Pipeline (90/100)
- Smart Batcher manages sequence distribution:
  - Length-aware grouping
  - Memory-quota tracking
  - Load balancing between GPUs
- Resource monitoring feedback loop adjusts batch sizes
File: dualgpuopt/batch/smart_batch.py

Domain-Specific Data Models:
- GPUMetrics: Comprehensive GPU state representation
- OptimizationEvent: GPU resource allocation events
- LayerProfile: Layer-specific performance metrics
- BatchGroup: Sequence batch configuration

The architecture implements specialized data flows for dual GPU optimization, focusing on real-time metric distribution, resource allocation, and workload balancing across multiple GPUs.

$END$